---
apiVersion: ripsaw.cloudbulldozer.io/v1alpha1
kind: Benchmark
metadata:
  name: {{item.name}}
  namespace: benchmark-operator
spec:
  metadata:
    collection: true
    targeted: false
  elasticsearch:
    url: {{ es_url }}
  system_metrics:
    collection: true
    es_url: {{ es_url }}
    prom_url: http://{{ prom_server.stdout }}
    prom_token: {{ prom_token }}
    metrics_profile: {{ metric_collection_url }}
  workload:
    name: uperf
    args:
{% if item.hostNetwork is true %}
      run_id: {{run_id}}-hostNet-datapath-rr
{% else %}
      run_id: {{run_id}}-datapath-rr
{% endif %}
      hostnetwork: {{ item.hostNetwork }}
      serviceip: false
      networkpolicy: false
      debug: false
{% if server_node.stdout is defined %}

      pin: true
      pin_server: {{server_node.stdout }}
      pin_client: {{client_node.stdout }}

{% else %}

      pin: false

{% endif %}
      samples: {{ samples }}
      pair: 1
      nthrs:
        - 1
      protos:
        - tcp
      test_types:
        - rr
      sizes:
        - 64
        - 1024
        - 16384
      runtime: 30